{
  "active": false,
  "activeVersion": null,
  "activeVersionId": null,
  "connections": {
    "Schedule Trigger (2x weekly)": {
      "main": [
        [
          {
            "node": "Set Topics & Keywords",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Topics & Keywords": {
      "main": [
        [
          {
            "node": "Fetch AI Headlines",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Fetch AI Headlines": {
      "main": [
        [
          {
            "node": "Topic Ideation",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Topic Ideation": {
      "main": [
        [
          {
            "node": "Prepare for Merge (A)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenRouter (Claude)": {
      "ai_languageModel": [
        [
          {
            "node": "Topic Ideation",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Gemini Fallback": {
      "ai_languageModel": [
        [
          {
            "node": "Topic Ideation",
            "type": "ai_languageModel",
            "index": 1
          }
        ]
      ]
    },
    "Topic Parser": {
      "ai_outputParser": [
        [
          {
            "node": "Topic Ideation",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Prepare for Merge (A)": {
      "main": [
        [
          {
            "node": "Deep Research (Tavily)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "New Article Form": {
      "main": [
        [
          {
            "node": "Process Form Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Process Form Data": {
      "main": [
        [
          {
            "node": "Research Manual Topic",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Research Manual Topic": {
      "main": [
        [
          {
            "node": "Prepare for Merge (B)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare for Merge (B)": {
      "main": [
        [
          {
            "node": "Deep Research (Tavily)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Deep Research (Tavily)": {
      "main": [
        [
          {
            "node": "Prepare Wiki Terms",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare Wiki Terms": {
      "main": [
        [
          {
            "node": "Split Wikipedia Terms",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Wikipedia Terms": {
      "main": [
        [
          {
            "node": "Wikipedia Lookup",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Aggregate Research Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wikipedia Lookup": {
      "main": [
        [
          {
            "node": "Split Wikipedia Terms",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate Research Data": {
      "main": [
        [
          {
            "node": "Keyword Strategy",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Keyword Strategy": {
      "main": [
        [
          {
            "node": "Blog Draft",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenRouter (Keywords)": {
      "ai_languageModel": [
        [
          {
            "node": "Keyword Strategy",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Gemini Keywords Fallback": {
      "ai_languageModel": [
        [
          {
            "node": "Keyword Strategy",
            "type": "ai_languageModel",
            "index": 1
          }
        ]
      ]
    },
    "Keywords Parser": {
      "ai_outputParser": [
        [
          {
            "node": "Keyword Strategy",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Blog Draft": {
      "main": [
        [
          {
            "node": "Verification Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenRouter (Blog)": {
      "ai_languageModel": [
        [
          {
            "node": "Blog Draft",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Gemini Blog Fallback": {
      "ai_languageModel": [
        [
          {
            "node": "Blog Draft",
            "type": "ai_languageModel",
            "index": 1
          }
        ]
      ]
    },
    "Blog Parser": {
      "ai_outputParser": [
        [
          {
            "node": "Blog Draft",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Verification Agent": {
      "main": [
        [
          {
            "node": "Prepare Final Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenRouter (Verify)": {
      "ai_languageModel": [
        [
          {
            "node": "Verification Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Gemini Verify Fallback": {
      "ai_languageModel": [
        [
          {
            "node": "Verification Agent",
            "type": "ai_languageModel",
            "index": 1
          }
        ]
      ]
    },
    "Verify Parser": {
      "ai_outputParser": [
        [
          {
            "node": "Verification Agent",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Prepare Final Data": {
      "main": [
        [
          {
            "node": "Create WordPress Post",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create WordPress Post": {
      "main": [
        [
          {
            "node": "Get WP Categories",
            "type": "main",
            "index": 0
          },
          {
            "node": "Get WP Tags",
            "type": "main",
            "index": 0
          },
          {
            "node": "Generate Image (Imagen)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get WP Categories": {
      "main": [
        [
          {
            "node": "Map Categories & Tags",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get WP Tags": {
      "main": [
        [
          {
            "node": "Map Categories & Tags",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Map Categories & Tags": {
      "main": [
        [
          {
            "node": "Assign Categories & Tags",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Assign Categories & Tags": {
      "main": [
        [
          {
            "node": "Prepare Email Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Generate Image (Imagen)": {
      "main": [
        [
          {
            "node": "Process Image Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Process Image Response": {
      "main": [
        [
          {
            "node": "Upload to WordPress Media",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Upload to WordPress Media": {
      "main": [
        [
          {
            "node": "Set Featured Image",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare Email Data": {
      "main": [
        [
          {
            "node": "Send Email Notification",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2026-01-18T20:21:36.707Z",
  "id": "zjHS5Hu99v86H9Xxf4JoI",
  "isArchived": false,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "name": "Blog Article Generator - processgate.ai",
  "nodes": [
    {
      "parameters": {
        "content": "# Blog Article Generator for processgate.ai\n\n**Two starting branches:**\n- **BRANCH A (Automatic)**: Schedule 2x weekly → AI selects topic from current trends\n- **BRANCH B (Manual)**: Web form → enter article title, keywords, length\n\n**New features:**\n- Wikipedia tool for fact-checking\n- Verification agent against hallucinations\n\n**Common part:**\nResearch (Tavily + Wikipedia) → Keywords/Categories → Blog Draft → Verification → WordPress (draft) → Imagen image → Gmail notification",
        "height": 376,
        "width": 600,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -400,
        -480
      ],
      "typeVersion": 1,
      "id": "info-note",
      "name": "Info"
    },
    {
      "parameters": {
        "content": "## BRANCH A: Automatic\nSchedule trigger → Tavily research → AI selects topic",
        "height": 480,
        "width": 720,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -400,
        -80
      ],
      "typeVersion": 1,
      "id": "branch-a-note",
      "name": "Branch A Note"
    },
    {
      "parameters": {
        "content": "## BRANCH B: Manual\nWeb form → enter article title, keywords, and length → research",
        "height": 480,
        "width": 720,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -400,
        480
      ],
      "typeVersion": 1,
      "id": "branch-b-note",
      "name": "Branch B Note"
    },
    {
      "parameters": {
        "content": "## Common Part\nMerge → Research (Tavily + Wikipedia) → Keywords → Blog Draft → VERIFICATION → WordPress → Image → Email",
        "height": 640,
        "width": 2800,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        400,
        -80
      ],
      "typeVersion": 1,
      "id": "common-note",
      "name": "Common Part Note"
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "weeks",
              "triggerAtDay": [
                1,
                4
              ],
              "triggerAtHour": 8
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [
        -320,
        80
      ],
      "id": "schedule-trigger",
      "name": "Schedule Trigger (2x weekly)"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -128,
        80
      ],
      "id": "set-topics",
      "name": "Set Topics & Keywords"
    },
    {
      "parameters": {
        "query": "={{ $json.topics.split(', ').map(t => t + ' 2025').join(' OR ') }}",
        "options": {
          "topic": "news",
          "max_results": 5,
          "time_range": "week"
        }
      },
      "type": "@tavily/n8n-nodes-tavily.tavily",
      "typeVersion": 1,
      "position": [
        80,
        80
      ],
      "id": "tavily-headlines",
      "name": "Fetch AI Headlines",
      "credentials": {
        "tavilyApi": {
          "id": "KmiWEKpArgJSNmSk",
          "name": "Tavily account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Here are current news from AI and automation:\n\n{{ $json.results.map((r, i) => `${i+1}. ${r.title}\\n   ${r.content}\\n   Source: ${r.url}`).join('\\n\\n') }}\n\nBased on these news, select ONE topic that will be most interesting for Czech audience focused on small and medium businesses. The topic should be practical and current.\n\nReturn JSON with these fields:\n- title: Czech article title (clear, specific, no clickbait)\n- angle: point of view / main idea of the article\n- searchQuery: English search query for further research\n- wikipediaTerms: array of 2-3 English terms for Wikipedia lookup (for fact verification)",
        "hasOutputParser": true,
        "needsFallback": true,
        "options": {
          "systemMessage": "You are an expert in content strategy for tech blogs. You select topics that are relevant for Czech entrepreneurs and managers interested in AI and automation. Respond ONLY with a valid JSON object."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        288,
        80
      ],
      "id": "topic-ideation",
      "name": "Topic Ideation"
    },
    {
      "parameters": {
        "model": "anthropic/claude-3.5-sonnet",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        128,
        288
      ],
      "id": "openrouter-topic",
      "name": "OpenRouter (Claude)",
      "credentials": {
        "openRouterApi": {
          "id": "XpZg3NCm0vRTBA75",
          "name": "OpenRouter Z-AGENCY 2026"
        }
      }
    },
    {
      "parameters": {
        "modelName": "models/gemini-1.5-flash",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        288,
        288
      ],
      "id": "gemini-topic-fallback",
      "name": "Gemini Fallback",
      "credentials": {
        "googlePalmApi": {
          "id": "O18dqBggPBVuy0CJ",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "schemaType": "manual",
        "inputSchema": "{\n  \"type\": \"object\",\n  \"required\": [\"title\", \"angle\", \"searchQuery\", \"wikipediaTerms\"],\n  \"properties\": {\n    \"title\": { \"type\": \"string\", \"description\": \"Czech article title\" },\n    \"angle\": { \"type\": \"string\", \"description\": \"Article point of view\" },\n    \"searchQuery\": { \"type\": \"string\", \"description\": \"English search query\" },\n    \"wikipediaTerms\": { \"type\": \"array\", \"items\": { \"type\": \"string\" }, \"description\": \"Terms for Wikipedia lookup\" }\n  }\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        448,
        288
      ],
      "id": "topic-parser",
      "name": "Topic Parser"
    },
    {
      "parameters": {
        "jsCode": "// Prepare data for merge from automatic branch\nconst topicData = $('Topic Ideation').item.json.output;\nconst originalData = $('Set Topics & Keywords').item.json;\n\nreturn {\n  json: {\n    source: 'automatic',\n    topic: topicData.title,\n    angle: topicData.angle,\n    searchQuery: topicData.searchQuery,\n    wikipediaTerms: topicData.wikipediaTerms || [],\n    keywords: originalData.keywords.split(', '),\n    targetLength: originalData.targetLength\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        528,
        80
      ],
      "id": "prepare-merge-a",
      "name": "Prepare for Merge (A)"
    },
    {
      "parameters": {
        "formTitle": "New Blog Article",
        "formDescription": "Enter information to generate an article for processgate.ai",
        "formFields": {
          "values": [
            {
              "fieldLabel": "Article Title",
              "placeholder": "e.g. Using n8n and Airtable for Employee Onboarding",
              "requiredField": true
            },
            {
              "fieldLabel": "Keywords",
              "placeholder": "n8n, Airtable, onboarding, HR automation",
              "requiredField": true
            },
            {
              "fieldLabel": "Article Length (characters)",
              "fieldType": "number",
              "placeholder": "4500"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.formTrigger",
      "typeVersion": 2.2,
      "position": [
        -320,
        640
      ],
      "id": "form-trigger",
      "name": "New Article Form",
      "webhookId": "blog-article-form"
    },
    {
      "parameters": {
        "jsCode": "// Extract data from form and prepare for research\nconst formData = $input.item.json;\n\n// Extract keywords for Wikipedia lookup\nconst keywords = formData['Keywords'].split(',').map(k => k.trim());\n\n// Create Wikipedia terms from keywords (English versions)\nconst wikipediaTerms = keywords.slice(0, 3).map(k => {\n  // Basic translation of common terms\n  const translations = {\n    'automatizace': 'automation',\n    'umělá inteligence': 'artificial intelligence',\n    'AI': 'artificial intelligence',\n    'produktivita': 'productivity',\n    'workflow': 'workflow',\n    'n8n': 'n8n',\n    'integrace': 'system integration',\n    'API': 'API',\n    'onboarding': 'onboarding',\n    'HR': 'human resources'\n  };\n  return translations[k.toLowerCase()] || k;\n});\n\nreturn {\n  json: {\n    source: 'manual',\n    topic: formData['Article Title'],\n    angle: 'User-submitted via form',\n    searchQuery: formData['Article Title'],\n    wikipediaTerms: wikipediaTerms,\n    keywords: keywords,\n    targetLength: formData['Article Length (characters)'] || 4500\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -128,
        640
      ],
      "id": "process-form",
      "name": "Process Form Data"
    },
    {
      "parameters": {
        "query": "={{ $json.topic }}",
        "options": {
          "max_results": 5,
          "time_range": "month",
          "include_raw_content": true
        }
      },
      "type": "@tavily/n8n-nodes-tavily.tavily",
      "typeVersion": 1,
      "position": [
        80,
        640
      ],
      "id": "tavily-manual",
      "name": "Research Manual Topic",
      "credentials": {
        "tavilyApi": {
          "id": "KmiWEKpArgJSNmSk",
          "name": "Tavily account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Prepare data for merge from manual branch\nconst processedData = $('Process Form Data').item.json;\nconst researchData = $input.item.json;\n\nreturn {\n  json: {\n    ...processedData,\n    initialResearch: researchData.results\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        288,
        640
      ],
      "id": "prepare-merge-b",
      "name": "Prepare for Merge (B)"
    },
    {
      "parameters": {
        "query": "={{ $json.searchQuery || $json.topic }}",
        "options": {
          "max_results": 5,
          "include_raw_content": true
        }
      },
      "type": "@tavily/n8n-nodes-tavily.tavily",
      "typeVersion": 1,
      "position": [
        720,
        320
      ],
      "id": "deep-research",
      "name": "Deep Research (Tavily)",
      "credentials": {
        "tavilyApi": {
          "id": "KmiWEKpArgJSNmSk",
          "name": "Tavily account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Prepare Wikipedia terms as individual items\n// Try to get data from either branch A or B\nlet mergeData = null;\n\ntry {\n  mergeData = $('Prepare for Merge (A)').first().json;\n} catch (e) {\n  try {\n    mergeData = $('Prepare for Merge (B)').first().json;\n  } catch (e2) {\n    // Fallback - get from input context\n    mergeData = {};\n  }\n}\n\nconst tavilyData = $input.item.json;\nconst terms = mergeData.wikipediaTerms || [];\n\n// Return array of items for Split In Batches\nreturn terms.map(term => ({\n  json: {\n    term: term,\n    mergeData: mergeData,\n    tavilyResults: tavilyData.results\n  }\n}));"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        832,
        320
      ],
      "id": "prepare-wiki-terms",
      "name": "Prepare Wiki Terms"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        1024,
        320
      ],
      "id": "split-wiki-terms",
      "name": "Split Wikipedia Terms"
    },
    {
      "parameters": {
        "url": "=https://en.wikipedia.org/api/rest_v1/page/summary/{{ encodeURIComponent($json.term) }}",
        "options": {
          "response": {
            "response": {
              "neverError": true
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        1232,
        320
      ],
      "id": "wikipedia-lookup",
      "name": "Wikipedia Lookup"
    },
    {
      "parameters": {
        "jsCode": "// Aggregate Wikipedia data\nconst allItems = $input.all();\n\n// Get original data from Prepare Wiki Terms (first item has all data)\nconst firstItem = $('Prepare Wiki Terms').first();\nconst mergeData = firstItem.json.mergeData;\nconst tavilyResults = firstItem.json.tavilyResults;\n\n// Collect Wikipedia summaries\nconst wikiData = allItems\n  .filter(item => item.json.extract) // Only successful lookups\n  .map(item => ({\n    title: item.json.title,\n    summary: item.json.extract,\n    url: item.json.content_urls?.desktop?.page || ''\n  }));\n\nreturn {\n  json: {\n    ...mergeData,\n    tavilyResearch: tavilyResults,\n    wikipediaData: wikiData\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1424,
        320
      ],
      "id": "aggregate-research",
      "name": "Aggregate Research Data"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Article topic: {{ $json.topic }}\nPoint of view: {{ $json.angle }}\nInput keywords: {{ $json.keywords.join(', ') }}\n\n## Tavily Research:\n{{ $json.tavilyResearch.map(r => `- ${r.title}: ${r.content}`).join('\\n') }}\n\n## Wikipedia Data (verified facts):\n{{ $json.wikipediaData.map(w => `### ${w.title}\\n${w.summary}`).join('\\n\\n') }}\n\nBased on this information, create:\n1. List of 5-8 SEO keywords in CZECH (relevant to the article)\n2. Suggest 1-3 CZECH categories from this list: Umělá inteligence, Automatizace, Digitální transformace, Produktivita, Nástroje a technologie, Případové studie, Novinky z oboru\n3. Suggest 3-5 CZECH tags (specific, relevant to the topic)\n\nReturn ONLY valid JSON.",
        "hasOutputParser": true,
        "needsFallback": true,
        "options": {
          "systemMessage": "You are an SEO specialist for Czech tech blogs. You create keywords and taxonomies in Czech language. Respond ONLY with a valid JSON object."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        1520,
        320
      ],
      "id": "keyword-strategy",
      "name": "Keyword Strategy"
    },
    {
      "parameters": {
        "model": "anthropic/claude-3.5-sonnet",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        1360,
        528
      ],
      "id": "openrouter-keywords",
      "name": "OpenRouter (Keywords)",
      "credentials": {
        "openRouterApi": {
          "id": "XpZg3NCm0vRTBA75",
          "name": "OpenRouter Z-AGENCY 2026"
        }
      }
    },
    {
      "parameters": {
        "modelName": "models/gemini-1.5-flash",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        1440,
        528
      ],
      "id": "gemini-keywords-fallback",
      "name": "Gemini Keywords Fallback",
      "credentials": {
        "googlePalmApi": {
          "id": "O18dqBggPBVuy0CJ",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "schemaType": "manual",
        "inputSchema": "{\n  \"type\": \"object\",\n  \"required\": [\"keywords\", \"categories\", \"tags\"],\n  \"properties\": {\n    \"keywords\": { \"type\": \"array\", \"items\": { \"type\": \"string\" }, \"description\": \"SEO keywords in Czech\" },\n    \"categories\": { \"type\": \"array\", \"items\": { \"type\": \"string\" }, \"description\": \"WordPress categories\" },\n    \"tags\": { \"type\": \"array\", \"items\": { \"type\": \"string\" }, \"description\": \"WordPress tags\" }\n  }\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        1520,
        528
      ],
      "id": "keywords-parser",
      "name": "Keywords Parser"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=# ARTICLE ASSIGNMENT\n\n**Topic (article title):** {{ $('Aggregate Research Data').item.json.topic }}\n**Point of view:** {{ $('Aggregate Research Data').item.json.angle }}\n**Target length:** {{ $('Aggregate Research Data').item.json.targetLength }} characters\n**SEO keywords:** {{ $json.output.keywords.join(', ') }}\n\n# RESEARCH DATA (Tavily)\n\n{{ $('Aggregate Research Data').item.json.tavilyResearch.map(r => `## ${r.title}\\n${r.content}\\n\\nSource: ${r.url}`).join('\\n\\n---\\n\\n') }}\n\n# VERIFIED FACTS (Wikipedia)\n\nThese are verified information you can use as a basis for factual claims:\n\n{{ $('Aggregate Research Data').item.json.wikipediaData.map(w => `## ${w.title}\\n${w.summary}\\n\\nSource: ${w.url}`).join('\\n\\n---\\n\\n') }}\n\n# INSTRUCTIONS\n\nWrite a blog article on the given topic. The article will be published on processgate.ai - a Czech blog about AI and automation for small and medium businesses.\n\n**IMPORTANT FOR FACTUAL ACCURACY:**\n- Use ONLY information from provided sources (Tavily research and Wikipedia)\n- If you cite statistics or numbers, they must come from sources\n- If you're not sure about a fact, don't include it\n- Cite sources naturally in the text\n\nReturn JSON with these fields:\n- title: final article title (can be adjusted from the assignment)\n- content: HTML article content (use p, h2, ul, li, strong, a tags)\n- excerpt: short perex (max 160 characters) for SEO\n- slug: URL slug (lowercase, hyphens, no diacritics)\n- imageQuery: English description for generating featured image (tech/AI style)\n- factualClaims: array of key factual claims in the article (for later verification)",
        "hasOutputParser": true,
        "needsFallback": true,
        "options": {
          "systemMessage": "You are an experienced Czech technology journalist and copywriter specializing in AI, automation, and digital transformation for small and medium businesses.\n\n## RULES FOR NATURAL STYLE\n\n- Write in excellent Czech, avoid unnecessary anglicisms\n- FORBIDDEN PHRASES (never use): \"V dnešní době\", \"V rychle se měnícím světě\", \"Je důležité poznamenat\", \"Není žádným tajemstvím\", \"Pojďme se podívat\", \"Jak jistě víte\", \"Není překvapením\"\n- Vary sentence length - alternate short with longer ones\n- Use specific examples, numbers, and facts\n- Write like a human, not an AI - add personal insights and opinions\n- Avoid passive voice where possible\n\n## RULES FOR FACTUAL ACCURACY\n\n- NEVER make up statistics, data, or facts\n- Use ONLY information from provided sources\n- If a source doesn't exist, don't reference it\n- Better to include fewer facts, but correct ones\n\n## ARTICLE STRUCTURE\n\n1. Opening paragraph - strong hook + summary of what reader will learn\n2. 3-4 sections with H2 headings - logically structured content\n3. Practical tips or case study\n4. Conclusion with clear call to action\n\n## FORMAT\n\n- HTML tags: p, h2, ul, li, strong, a (for links)\n- Don't use h1 (that's the article title)\n- Respond ONLY with a valid JSON object"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        1760,
        320
      ],
      "id": "blog-draft",
      "name": "Blog Draft"
    },
    {
      "parameters": {
        "model": "anthropic/claude-3.5-sonnet",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        1600,
        528
      ],
      "id": "openrouter-blog",
      "name": "OpenRouter (Blog)",
      "credentials": {
        "openRouterApi": {
          "id": "XpZg3NCm0vRTBA75",
          "name": "OpenRouter Z-AGENCY 2026"
        }
      }
    },
    {
      "parameters": {
        "modelName": "models/gemini-1.5-flash",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        1760,
        528
      ],
      "id": "gemini-blog-fallback",
      "name": "Gemini Blog Fallback",
      "credentials": {
        "googlePalmApi": {
          "id": "O18dqBggPBVuy0CJ",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "schemaType": "manual",
        "inputSchema": "{\n  \"type\": \"object\",\n  \"required\": [\"title\", \"content\", \"excerpt\", \"slug\", \"imageQuery\", \"factualClaims\"],\n  \"properties\": {\n    \"title\": { \"type\": \"string\", \"description\": \"Article title\" },\n    \"content\": { \"type\": \"string\", \"description\": \"HTML article content\" },\n    \"excerpt\": { \"type\": \"string\", \"description\": \"Short perex for SEO\" },\n    \"slug\": { \"type\": \"string\", \"description\": \"URL slug\" },\n    \"imageQuery\": { \"type\": \"string\", \"description\": \"Description for image generation\" },\n    \"factualClaims\": { \"type\": \"array\", \"items\": { \"type\": \"string\" }, \"description\": \"Key factual claims for verification\" }\n  }\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        1920,
        528
      ],
      "id": "blog-parser",
      "name": "Blog Parser"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=# ARTICLE VERIFICATION\n\nCheck the following article and its factual claims.\n\n## ARTICLE:\n**Title:** {{ $json.output.title }}\n\n**Content:**\n{{ $json.output.content }}\n\n## FACTUAL CLAIMS TO VERIFY:\n{{ $json.output.factualClaims.map((c, i) => `${i+1}. ${c}`).join('\\n') }}\n\n## AVAILABLE SOURCES FOR VERIFICATION:\n\n### Tavily Research:\n{{ $('Aggregate Research Data').item.json.tavilyResearch.map(r => `- ${r.title}: ${r.content}`).join('\\n') }}\n\n### Wikipedia Data:\n{{ $('Aggregate Research Data').item.json.wikipediaData.map(w => `- ${w.title}: ${w.summary}`).join('\\n') }}\n\n## TASK:\n\n1. Check each factual claim against available sources\n2. Flag problematic claims that cannot be verified\n3. Suggest specific corrections for unverifiable claims\n\nReturn JSON with verification result.",
        "hasOutputParser": true,
        "needsFallback": true,
        "options": {
          "systemMessage": "You are a strict fact-checker for a technology blog. Your task is to identify potential AI hallucinations and unverifiable claims. Be critical but constructive - suggest specific corrections.\n\nIf the article is fine, mark verified: true.\nIf you find issues, mark verified: false and provide specific corrections."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        2000,
        320
      ],
      "id": "verification-agent",
      "name": "Verification Agent"
    },
    {
      "parameters": {
        "model": "anthropic/claude-3.5-sonnet",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        2000,
        528
      ],
      "id": "openrouter-verify",
      "name": "OpenRouter (Verify)",
      "credentials": {
        "openRouterApi": {
          "id": "XpZg3NCm0vRTBA75",
          "name": "OpenRouter Z-AGENCY 2026"
        }
      }
    },
    {
      "parameters": {
        "modelName": "models/gemini-1.5-flash",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        2080,
        528
      ],
      "id": "gemini-verify-fallback",
      "name": "Gemini Verify Fallback",
      "credentials": {
        "googlePalmApi": {
          "id": "O18dqBggPBVuy0CJ",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "schemaType": "manual",
        "inputSchema": "{\n  \"type\": \"object\",\n  \"required\": [\"verified\", \"issues\", \"correctedContent\"],\n  \"properties\": {\n    \"verified\": { \"type\": \"boolean\", \"description\": \"True if article passed verification\" },\n    \"issues\": { \"type\": \"array\", \"items\": { \"type\": \"string\" }, \"description\": \"List of found issues\" },\n    \"correctedContent\": { \"type\": \"string\", \"description\": \"Corrected HTML content (or original if no issues)\" },\n    \"verificationNotes\": { \"type\": \"string\", \"description\": \"Verification notes for review\" }\n  }\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        2160,
        528
      ],
      "id": "verify-parser",
      "name": "Verify Parser"
    },
    {
      "parameters": {
        "jsCode": "// Combine data from BlogDraft and Verification\nconst blogData = $('Blog Draft').item.json.output;\nconst verifyData = $json.output;\nconst keywordData = $('Keyword Strategy').item.json.output;\nconst mergeData = $('Aggregate Research Data').item.json;\n\n// Use corrected content if exists, otherwise original\nconst finalContent = verifyData.correctedContent || blogData.content;\n\nreturn {\n  json: {\n    title: blogData.title,\n    content: finalContent,\n    excerpt: blogData.excerpt,\n    slug: blogData.slug,\n    imageQuery: blogData.imageQuery,\n    categories: keywordData.categories,\n    tags: keywordData.tags,\n    keywords: keywordData.keywords,\n    source: mergeData.source,\n    targetLength: mergeData.targetLength,\n    verified: verifyData.verified,\n    verificationIssues: verifyData.issues,\n    verificationNotes: verifyData.verificationNotes\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2208,
        320
      ],
      "id": "parse-final-json",
      "name": "Prepare Final Data"
    },
    {
      "parameters": {
        "title": "={{ $json.title }}",
        "additionalFields": {
          "content": "={{ $json.content }}",
          "slug": "={{ $json.slug }}",
          "status": "draft"
        }
      },
      "type": "n8n-nodes-base.wordpress",
      "typeVersion": 1,
      "position": [
        2400,
        320
      ],
      "id": "create-post",
      "name": "Create WordPress Post",
      "credentials": {
        "wordpressApi": {
          "id": "flqY5YMCvIpv5fpx",
          "name": "Processgate.ai_propojeni"
        }
      }
    },
    {
      "parameters": {
        "url": "https://processgate.ai/wp-json/wp/v2/categories",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "wordpressApi",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "per_page",
              "value": "100"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        2608,
        80
      ],
      "id": "get-categories",
      "name": "Get WP Categories",
      "credentials": {
        "wordpressApi": {
          "id": "flqY5YMCvIpv5fpx",
          "name": "Processgate.ai_propojeni"
        }
      }
    },
    {
      "parameters": {
        "url": "https://processgate.ai/wp-json/wp/v2/tags",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "wordpressApi",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "per_page",
              "value": "100"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        2608,
        240
      ],
      "id": "get-tags",
      "name": "Get WP Tags",
      "credentials": {
        "wordpressApi": {
          "id": "flqY5YMCvIpv5fpx",
          "name": "Processgate.ai_propojeni"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Map AI categories and tags to WordPress IDs\n// Wait for both inputs - categories come on index 0, tags on index 1\nconst allInputs = $input.all();\n\n// Get categories and tags from all items\nlet wpCategories = [];\nlet wpTags = [];\n\nfor (const item of allInputs) {\n  if (Array.isArray(item.json)) {\n    // Check if it's categories or tags based on content\n    if (item.json[0]?.taxonomy === 'category' || item.json[0]?.parent !== undefined) {\n      wpCategories = item.json;\n    } else {\n      wpTags = item.json;\n    }\n  }\n}\n\n// If still empty, try to get from specific nodes\nif (wpCategories.length === 0) {\n  try {\n    const catData = $('Get WP Categories').all();\n    wpCategories = catData.flatMap(d => Array.isArray(d.json) ? d.json : [d.json]);\n  } catch (e) {}\n}\n\nif (wpTags.length === 0) {\n  try {\n    const tagData = $('Get WP Tags').all();\n    wpTags = tagData.flatMap(d => Array.isArray(d.json) ? d.json : [d.json]);\n  } catch (e) {}\n}\n\nconst aiCategories = $('Prepare Final Data').first().json.categories || [];\nconst aiTags = $('Prepare Final Data').first().json.tags || [];\nconst postId = $('Create WordPress Post').first().json.id;\n\n// Map category names to IDs\nconst categoryIds = [];\nfor (const aiCat of aiCategories) {\n  const match = wpCategories.find(wpCat => \n    wpCat.name?.toLowerCase().includes(aiCat.toLowerCase()) ||\n    aiCat.toLowerCase().includes(wpCat.name?.toLowerCase())\n  );\n  if (match) {\n    categoryIds.push(match.id);\n  }\n}\n\n// If no category found, use default\nif (categoryIds.length === 0) {\n  categoryIds.push(1); // Uncategorized\n}\n\n// Map tag names to IDs\nconst tagIds = [];\nfor (const aiTag of aiTags) {\n  const match = wpTags.find(wpTag => \n    wpTag.name?.toLowerCase() === aiTag.toLowerCase() ||\n    wpTag.slug?.toLowerCase() === aiTag.toLowerCase().replace(/\\s+/g, '-')\n  );\n  if (match) {\n    tagIds.push(match.id);\n  }\n}\n\nreturn {\n  json: {\n    postId: postId,\n    categoryIds: categoryIds,\n    tagIds: tagIds\n  }\n};\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2800,
        160
      ],
      "id": "map-categories",
      "name": "Map Categories & Tags"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://processgate.ai/wp-json/wp/v2/posts/{{ $json.postId }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "wordpressApi",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"categories\": {{ JSON.stringify($json.categoryIds) }},\n  \"tags\": {{ JSON.stringify($json.tagIds) }}\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        3008,
        160
      ],
      "id": "assign-taxonomies",
      "name": "Assign Categories & Tags",
      "credentials": {
        "wordpressApi": {
          "id": "flqY5YMCvIpv5fpx",
          "name": "Processgate.ai_propojeni"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://generativelanguage.googleapis.com/v1beta/models/imagen-3.0-generate-002:predict",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googlePalmApi",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"instances\": [\n    {\n      \"prompt\": \"{{ $('Prepare Final Data').item.json.imageQuery }}, professional, modern tech style, no text, high quality, 16:9 aspect ratio\"\n    }\n  ],\n  \"parameters\": {\n    \"sampleCount\": 1,\n    \"aspectRatio\": \"16:9\"\n  }\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        2608,
        480
      ],
      "id": "generate-image",
      "name": "Generate Image (Imagen)",
      "credentials": {
        "googlePalmApi": {
          "id": "O18dqBggPBVuy0CJ",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Extract base64 image from Imagen response\nconst response = $input.item.json;\n\nlet imageBase64 = '';\nif (response.predictions && response.predictions[0]) {\n  imageBase64 = response.predictions[0].bytesBase64Encoded;\n}\n\nconst postId = $('Create WordPress Post').item.json.id;\nconst slug = $('Prepare Final Data').item.json.slug;\n\nreturn {\n  json: {\n    postId: postId,\n    imageBase64: imageBase64,\n    filename: `${slug}-featured.png`\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2800,
        480
      ],
      "id": "process-image",
      "name": "Process Image Response"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://processgate.ai/wp-json/wp/v2/media",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "wordpressApi",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Disposition",
              "value": "=attachment; filename=\"{{ $json.filename }}\""
            },
            {
              "name": "Content-Type",
              "value": "image/png"
            }
          ]
        },
        "sendBody": true,
        "contentType": "raw",
        "body": "={{ Buffer.from($json.imageBase64, 'base64') }}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        3008,
        480
      ],
      "id": "upload-media",
      "name": "Upload to WordPress Media",
      "credentials": {
        "wordpressApi": {
          "id": "flqY5YMCvIpv5fpx",
          "name": "Processgate.ai_propojeni"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://processgate.ai/wp-json/wp/v2/posts/{{ $('Process Image Response').item.json.postId }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "wordpressApi",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"featured_media\": {{ $json.id }}\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        3200,
        480
      ],
      "id": "set-featured-image",
      "name": "Set Featured Image",
      "credentials": {
        "wordpressApi": {
          "id": "flqY5YMCvIpv5fpx",
          "name": "Processgate.ai_propojeni"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Prepare data for email notification\n// Use .first() instead of .item to avoid paired item issues\nconst postData = $('Create WordPress Post').first().json;\nconst finalData = $('Prepare Final Data').first().json;\n\nconst adminUrl = `https://processgate.ai/wp-admin/post.php?post=${postData.id}&action=edit`;\n\n// Warning if verification found issues\nlet verificationWarning = '';\nif (!finalData.verified && finalData.verificationIssues && finalData.verificationIssues.length > 0) {\n  verificationWarning = `\\n\\n⚠️ VERIFICATION FOUND ISSUES:\\n${finalData.verificationIssues.map(i => `- ${i}`).join('\\n')}\\n\\nNotes: ${finalData.verificationNotes || 'none'}`;\n}\n\nreturn {\n  json: {\n    subject: `${finalData.verified ? '✅' : '⚠️'} New article for review: ${finalData.title}`,\n    postTitle: finalData.title,\n    postExcerpt: finalData.excerpt,\n    adminUrl: adminUrl,\n    categories: (finalData.categories || []).join(', '),\n    tags: (finalData.tags || []).join(', '),\n    source: finalData.source === 'automatic' ? 'Automatically generated' : 'Manually submitted (form)',\n    targetLength: finalData.targetLength,\n    actualLength: (finalData.content || '').length,\n    verified: finalData.verified,\n    verificationWarning: verificationWarning,\n    verificationNotes: finalData.verificationNotes || 'Article passed verification without issues.'\n  }\n};\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        3200,
        320
      ],
      "id": "prepare-email",
      "name": "Prepare Email Data"
    },
    {
      "parameters": {
        "resource": "draft",
        "subject": "={{ $json.subject }}",
        "emailType": "html",
        "message": "=<h2>{{ $json.postTitle }}</h2>\n\n<p><strong>Excerpt:</strong> {{ $json.postExcerpt }}</p>\n\n<p><strong>Source:</strong> {{ $json.source }}</p>\n<p><strong>Length:</strong> {{ $json.actualLength }} characters (target: {{ $json.targetLength }})</p>\n\n<p><strong>Categories:</strong> {{ $json.categories }}</p>\n<p><strong>Tags:</strong> {{ $json.tags }}</p>\n\n<hr>\n\n<h3>{{ $json.verified ? '✅ Verification OK' : '⚠️ Requires review' }}</h3>\n<p>{{ $json.verificationNotes }}</p>\n{{ $json.verificationWarning }}\n\n<hr>\n\n<p><a href=\"{{ $json.adminUrl }}\" style=\"background: #0073aa; color: white; padding: 12px 24px; text-decoration: none; border-radius: 4px;\">Open article in WordPress</a></p>\n\n<p style=\"color: #666; font-size: 12px;\">This email was automatically generated by n8n workflow \"Blog Article Generator\" with fact-checking verification.</p>",
        "options": {
          "sendTo": "info@processgate.ai"
        }
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        3408,
        320
      ],
      "id": "send-notification",
      "name": "Send Email Notification",
      "webhookId": "0e14cebb-a093-4de3-a4fe-9bba38451d46",
      "credentials": {
        "gmailOAuth2": {
          "id": "qNSaYVEcaWOf5U3k",
          "name": "Gmail zmidloch@z-agency.cz"
        }
      }
    }
  ],
  "settings": {
    "executionOrder": "v1",
    "availableInMCP": false,
    "timeSavedMode": "fixed",
    "callerPolicy": "workflowsFromSameOwner",
    "errorWorkflow": "zVAjJgKV17IWzFP7"
  },
  "shared": [
    {
      "updatedAt": "2026-01-18T20:21:36.707Z",
      "createdAt": "2026-01-18T20:21:36.707Z",
      "role": "workflow:owner",
      "workflowId": "zjHS5Hu99v86H9Xxf4JoI",
      "projectId": "XqkS7oX8lMj4YbIK"
    }
  ],
  "staticData": null,
  "tags": [
    {
      "updatedAt": "2025-11-25T10:02:49.590Z",
      "createdAt": "2025-11-25T10:02:49.590Z",
      "id": "iu8EkneS24SJyD0c",
      "name": "AI"
    }
  ],
  "triggerCount": 2,
  "updatedAt": "2026-01-19T14:08:06.856Z",
  "versionId": "a0193495-783e-4b22-aa59-9127e7513fa3"
}